# app.py
import streamlit as st

st.set_page_config(page_title="ë² ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ í‚¤ì˜¤ìŠ¤í¬ ğŸ¨", page_icon="ğŸ¦", layout="centered")

# ----- ë°ì´í„° ì •ì˜ -----
# ìš©ê¸°ë³„(ë˜ëŠ” ë©”ë‰´ë³„) ê°€ëŠ¥í•œ ë§› ëª©ë¡
FLAVORS = {
    "ì»µ (1ìŠ¤ì¿±)": ["ë°”ë‹ë¼", "ì´ˆì½œë¦¿", "ìŠ¤íŠ¸ë¡œë² ë¦¬", "ë¯¼íŠ¸ì´ˆì½”", "ì¿ í‚¤ì•¤í¬ë¦¼", "ë…¹ì°¨"],
    "ì»µ (2ìŠ¤ì¿±)": ["ë°”ë‹ë¼", "ì´ˆì½œë¦¿", "ìŠ¤íŠ¸ë¡œë² ë¦¬", "ë¯¼íŠ¸ì´ˆì½”", "ì¿ í‚¤ì•¤í¬ë¦¼", "ë…¹ì°¨", "ì¹˜ì¦ˆì¼€ì´í¬"],
    "ì»µ (3ìŠ¤ì¿±)": ["ë°”ë‹ë¼", "ì´ˆì½œë¦¿", "ìŠ¤íŠ¸ë¡œë² ë¦¬", "ë¯¼íŠ¸ì´ˆì½”", "ì¿ í‚¤ì•¤í¬ë¦¼", "ë…¹ì°¨", "ì¹˜ì¦ˆì¼€ì´í¬", "ì†”í‹°ì¹´ë¼ë©œ"],
    "ì½˜ (2ìŠ¤ì¿±)": ["ë°”ë‹ë¼", "ì´ˆì½œë¦¿", "ë¯¼íŠ¸ì´ˆì½”", "ì½”íŠ¼ìº”ë””"],
    "íŒŒì¸íŠ¸ (ê°€ì •ìš©, 473ml)": ["ë°”ë‹ë¼", "ì´ˆì½œë¦¿", "ìŠ¤íŠ¸ë¡œë² ë¦¬", "ì¿ í‚¤ì•¤í¬ë¦¼", "ë…¹ì°¨", "ì¹˜ì¦ˆì¼€ì´í¬", "ì†”í‹°ì¹´ë¼ë©œ", "ë§ê³ "],
}

# ìš©ê¸°ë³„ ê°€ê²©(ì›)
PRICES = {
    "ì»µ (1ìŠ¤ì¿±)": 3000,
    "ì»µ (2ìŠ¤ì¿±)": 5200,
    "ì»µ (3ìŠ¤ì¿±)": 7200,
    "ì½˜ (2ìŠ¤ì¿±)": 5500,
    "íŒŒì¸íŠ¸ (ê°€ì •ìš©, 473ml)": 12000,
}

# ë¶€ê°€ì„¸ í¬í•¨ ì•ˆë‚´ (ê°„ë‹¨íˆ í‘œê¸°)
TAX_RATE = 0.1  # ì˜ˆì‹œ: 10% ë¶€ê°€ì„¸ í¬í•¨(í‘œì‹œ ëª©ì )

# ----- UI ì‹œì‘ -----
st.title("ğŸ¦ ë² ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ í‚¤ì˜¤ìŠ¤í¬")
st.write("ì•ˆë…•í•˜ì„¸ìš”! ë§›ìˆëŠ” ì•„ì´ìŠ¤í¬ë¦¼ ê³ ë¥´ì‹œì£  â€” í¸í•˜ê²Œ ì„ íƒí•´ ì£¼ì„¸ìš” ğŸ˜Š")

# 1) ë§¤ì¥/í¬ì¥ ì„ íƒ
dine_option = st.radio("1) ë§¤ì¥ì—ì„œ ë“œì‹¤ë˜ìš”, í¬ì¥í•´ ê°€ì‹¤ë˜ìš”?", options=["ë§¤ì¥(ë¨¹ê³ ê°€ê¸°) ğŸª‘", "í¬ì¥(í…Œì´í¬ì•„ì›ƒ) ğŸ›ï¸"], index=0, horizontal=True)

# 2) ìš©ê¸° ì„ íƒ
st.markdown("### 2) ìš©ê¸°/ë©”ë‰´ ì„ íƒ")
container = st.selectbox("ì›í•˜ì‹œëŠ” ìš©ê¸°ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”:", options=list(PRICES.keys()))

# ì•ˆë‚´ ë¬¸êµ¬
st.info(f"ì„ íƒ: **{container}** â€” ê°€ê²©: {PRICES[container]:,}ì› (ê¸°ë³¸ê°€)")

# 3) ìš©ê¸°ì— ë§ëŠ” ë§› ê³ ë¥´ê¸° (ìŠ¤ì¿± ìˆ˜ì— ë§ì¶° selectbox ìƒì„±)
# ìŠ¤ì¿± ìˆ˜ ì¶”ì¶œ (ë¬¸ìì—´ì—ì„œ ìˆ«ì ì¶”ì¶œí•˜ê±°ë‚˜ íŒŒì¸íŠ¸ëŠ” ì˜ˆì™¸)
if "1ìŠ¤ì¿±" in container:
    scoops = 1
elif "2ìŠ¤ì¿±" in container:
    scoops = 2
elif "3ìŠ¤ì¿±" in container:
    scoops = 3
else:
    # íŒŒì¸íŠ¸ ë“±ì€ "í•œ í†µ" ê°œë… -> allow up to 3 ë§› í˜¼í•© ê°€ëŠ¥
    scoops = 3

st.markdown(f"### 3) ë§› ì„ íƒ ğŸ¨  (ìµœëŒ€ {scoops}ê°œ)")
available = FLAVORS.get(container, [])

# We'll create separate selectboxes for each scoop to avoid multiselect-count handling
selected_flavors = []
for i in range(1, scoops + 1):
    flavor = st.selectbox(f"ìŠ¤ì¿± {i}ë²ˆ ë§› ì„ íƒ", options=["(ì„ íƒ ì•ˆí•¨)"] + available, index=0, key=f"flav_{i}")
    if flavor != "(ì„ íƒ ì•ˆí•¨)":
        selected_flavors.append(flavor)

# ì¤‘ë³µ ì„ íƒ í—ˆìš© ì—¬ë¶€ ì•ˆë‚´ (ì¤‘ë³µ í—ˆìš©)
st.caption("ë™ì¼í•œ ë§›ì„ ì—¬ëŸ¬ ìŠ¤ì¿± ê³¨ë¼ë„ ë©ë‹ˆë‹¤ â€” ì·¨í–¥ê» ê³¨ë¼ì£¼ì„¸ìš”! ğŸ˜‹")

# 4) ê°€ê²© ê³„ì‚° ë° ê²°ì œ ë°©ì‹ ì„ íƒ
base_price = PRICES[container]
# ê°„ë‹¨í•œ ê·œì¹™: íŒŒì¸íŠ¸ëŠ” ê³ ì •ê°€, ì»µ/ì½˜ì€ ê³ ì •ê°€ë¡œ ì²˜ë¦¬(ì´ë¯¸ PRICESì— ë°˜ì˜)
subtotal = base_price

# ë¶€ê°€ì„¸(í‘œì‹œ ëª©ì )
tax = int(subtotal * TAX_RATE)
total = subtotal + tax

st.markdown("### 4) ê²°ì œ ì •ë³´")
st.write(f"- ì„ íƒëœ ë§›: **{', '.join(selected_flavors) if selected_flavors else 'ì„ íƒ ì—†ìŒ'}**")
st.write(f"- ì†Œê³„: {subtotal:,}ì›")
st.write(f"- ë¶€ê°€ì„¸ (ì˜ˆì‹œ 10%): {tax:,}ì›")
st.write(f"**ì´ í•©ê³„: {total:,}ì›** ğŸ§¾")

payment = st.radio("ê²°ì œ ë°©ë²•ì„ ê³¨ë¼ì£¼ì„¸ìš”:", options=["í˜„ê¸ˆ ê²°ì œ ğŸ’µ", "ì¹´ë“œ ê²°ì œ ğŸ’³"], index=1, horizontal=True)

# ê²°ì œ ë²„íŠ¼
if st.button("ê²°ì œ ì§„í–‰í•˜ê¸° âœ…"):
    # ê°„ë‹¨í•œ ìœ íš¨ì„± ê²€ì‚¬
    if not selected_flavors:
        st.warning("ì•„ì§ ë§›ì„ í•œ ê°œë„ ì„ íƒí•˜ì§€ ì•Šìœ¼ì…¨ì–´ìš”. ìµœì†Œ 1ê°œì˜ ë§›ì„ ê³¨ë¼ì£¼ì„¸ìš” ğŸ¨")
    else:
        # ê²°ì œ ì‹œë‚˜ë¦¬ì˜¤(ëª¨ì˜)
        if payment.startswith("í˜„ê¸ˆ"):
            st.success(f"í˜„ê¸ˆê²°ì œ ì„ íƒ ì™„ë£Œ! ì´ {total:,}ì›ì…ë‹ˆë‹¤. ì¹´ìš´í„°ì—ì„œ ê³„ì‚°í•´ ì£¼ì„¸ìš”. ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ™")
            st.balloons()
        else:
            st.success(f"ì¹´ë“œê²°ì œ ì„ íƒ ì™„ë£Œ! ì´ {total:,}ì›ì´ ì¹´ë“œë¡œ ê²°ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë§›ìˆê²Œ ë“œì„¸ìš” ğŸ‰")
            st.balloons()

        # ê°„ë‹¨í•œ ì˜ìˆ˜ì¦ ì¶œë ¥
        st.markdown("---")
        st.header("ì˜ìˆ˜ì¦ ğŸ§¾")
        st.write(f"- ì£¼ë¬¸ ìœ í˜•: **{dine_option.split()[0]}**")
        st.write(f"- ìš©ê¸°: **{container}**")
        st.write(f"- ë§›: **{', '.join(selected_flavors)}**")
        st.write(f"- ê²°ì œë°©ë²•: **{payment}**")
        st.write(f"- ì´ì•¡: **{total:,}ì›**")
        st.caption("ì£¼ë¬¸í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš” ğŸ˜Š")

# í•˜ë‹¨ ë„ì›€ë§
st.markdown("---")
st.write("ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ ì§ì›ì—ê²Œ ë§ì”€í•´ ì£¼ì„¸ìš”. (ì´ í™”ë©´ì€ ë°ëª¨ìš© í‚¤ì˜¤ìŠ¤í¬ì…ë‹ˆë‹¤.)")
st.write("ë¬¸ì˜: ë² ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ í‚¤ì˜¤ìŠ¤í¬ ë°ëª¨íŒ€ ğŸ¨")
